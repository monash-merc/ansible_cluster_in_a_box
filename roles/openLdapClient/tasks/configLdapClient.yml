---
- name: "Copy configuration files to ldap client"
  template: src={{ item }}.j2 dest=/etc/{{ item }}
  with_items:
    - pam_ldap.conf
    - nsswitch.conf
  sudo: true

- name: "Copy the CA cert"
  copy: src={{ ldapCaCertSrc }} dest={{ ldapCaCertFile }} owner=root mode=644
  sudo: true
  when: ldapCaCertSrc is defined

- name: "Copy pam config to ldap client"
  template: src=system-auth-ac.j2 dest=/etc/pam.d/system-auth-ac
  sudo: true

- name: "Copy system auth to ldap client"
  template: src=authconfig.j2 dest=/etc/sysconfig/authconfig
  sudo: true

- name: "Copy ldap.conf file "
  template: src=ldap.conf.j2 dest=/etc/openldap/ldap.conf
  sudo: true

- name: "Add LDAP server IP address to /etc/hosts"
  lineinfile: dest=/etc/hosts line="{{ ldapServerHostIpLine }}" state=present insertafter=EOF
  sudo: true
  when: ldapServerHostIpLine is defined

- name: "Copy sssd.conf to ldap client"
  template: src=sssd.j2 dest=/etc/sssd/sssd.conf owner=root group=root mode=600
  sudo: true
  notify: restart sssd


