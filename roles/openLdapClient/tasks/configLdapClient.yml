---
- name: "Copy configuration files to ldap client"
  template: src={{ item }}.j2 dest=/etc/{{ item }}
  with_items:
    - pam_ldap.conf
    - idmapd.conf
    - nsswitch.conf
  sudo: true

- name: "Copy pam config to ldap client"
  template: src=system-auth-ac.j2 dest=/etc/pam.d/system-auth-ac
  sudo: true

- name: "Copy system auth to ldap client"
  template: src=authconfig.j2 dest=/etc/sysconfig/authconfig
  sudo: true

- name: "Insert LDAP IP address LDAP to /etc/hosts"
  lineinfile: dest=/etc/hosts line='130.220.209.234 m2-w.massive.org.au' state=present insertafter=EOF
#  lineinfile: dest=/etc/hosts regexp=^130.220.209.234 line=130.220.209.234 m2-w.massive.org.au state=present insertafter=EOF
#  lineinfile: dest=/etc/hosts regexp=^130.220.209.234 line=130.220.209.234 m2-w.massive.org.au state=present 
  sudo: true

- name: "Copy ldap.conf file "
  template: src=ldap.conf.j2 dest=/etc/openldap/ldap.conf
  sudo: true

- name: "Copy ldap cacert file"
  copy: src={{ ldapCaCertFileSource }}/cacert.pem dest=/etc/openldap/certs/cacert.pem owner=root group=root mode=0644
  sudo: true

- name: "Copy sssd.conf to ldap client"
  template: src=sssd.j2 dest=/etc/sssd/sssd.conf owner=root group=root mode=600
  sudo: true
  notify: restart sssd 


